| ドキュメント名 | 製品要求仕様書 (Product Requirements Document) |
| :--- | :--- |
| **製品名** | 相次相続控除 計算シミュレーター |
| **バージョン** | 1.0 |
| **最終更新日** | 2025/06/26 |
| **オーナー** | 製品管理部 |

---

### 1. 背景と課題

#### 1.1. 課題の特定
相続税の計算の中でも「相次相続控除」は、10年以内に二度の相続（例：父の死後、母が亡くなる）が発生した場合に適用される税額控除制度ですが、その適用条件と計算式は非常に複雑です。

> **国税庁が定める計算式:**
> `控除額 = A × {C / (B - A)} × (D / C) × {(10 - E) / 10}`

この計算には、前回の相続税額、取得財産額、今回の相続財産総額、各相続人の取得財産額、経過年数など、複数の専門的な変数が必要となります。税務知識のない一般の個人が、自身に控除が適用されるか、また、いくら控除されるのかを正確に把握することは極めて困難です。この情報の非対称性が、適切な相続準備や意思決定の障壁となっています。

#### 1.2. 既存の解決策とその限界
現状、この問題を解決するには、税理士などの専門家に相談する必要があります。しかし、それには費用と時間がかかり、初期段階での「もしこうだったら？」という気軽な試算には不向きです。Web上の解説記事は多数存在しますが、自身の具体的な状況に当てはめて計算するまでには至らないケースがほとんどです。

### 2. 製品の目的と成功指標

#### 2.1. 目的
本製品は、**複雑な相次相続控除の計算プロセスを、専門知識がないユーザーでも直感的かつ視覚的にシミュレーションできるWebアプリケーション**を提供することを目的とします。

具体的には、以下の価値を提供します。
- **直感的な理解の促進**: 視覚的な家系図を通じて、複雑な相続関係と控除額の関係性を一目で把握できるようにする。
- **意思決定の支援**: 財産配分などのシナリオをリアルタイムで試算できる環境を提供し、ユーザーの計画的な相続準備を支援する。
- **専門家との連携円滑化**: ユーザーが自身の状況を整理し、専門家へ相談する際のたたき台として活用できる質の高い情報を提供する。

#### 2.2. 成功指標
- **タスク完了率**: 新規ユーザーが、チュートリアルなしで最初の計算シミュレーションを完了できる割合が80%以上であること。
- **エンゲージメント**: ユーザーセッションにおいて、少なくとも1回以上の数値（日付、金額など）変更が行われ、リアルタイム計算機能が利用される割合。
- **ユーザーフィードバック**: 専門家（税理士、FP）ユーザーから「顧客説明に有用」「初期試算の時間が短縮された」といった肯定的な評価を得ること。

### 3. 対象ユーザー（ペルソナ）

#### ペルソナ1：相続準備中の一般個人
| | |
| :--- | :--- |
| **名前** | 佐藤 和夫（65歳） |
| **背景** | 5年前に父が亡くなり、母が財産の大半を相続。最近、その母の健康が優れないため、万が一の際の相続（二次相続）について考え始めた。自身と妹が相続人になる予定。 |
| **課題** | - 相次相続控除という制度があるらしいが、自分たちが対象になるのか分からない。<br>- 税理士に相談する前に、控除額がどの程度になるか、財産の分け方でどう変わるかを大まかに知りたい。<br>- 専門用語が多く、Webで調べても自分のケースに当てはめられない。 |
| **ニーズ** | - 専門用語を意識せず、簡単な入力で結果がわかるツール。<br>- 誰が、いくら控除を受けられるのかが一目でわかる視覚的な表現。<br>- 「もし、母が取得する財産が少なかったら？」といった仮説を試せる機能。 |

#### ペルソナ2：プロフェッショナル（FP/税理士）
| | |
| :--- | :--- |
| **名前** | 高橋 恵子（40歳） |
| **背景** | 独立系ファイナンシャルプランナー。顧客から相続に関する相談を受けることが多い。 |
| **課題** | - 顧客に相次相続控除の仕組みを説明する際、口頭や図では伝わりにくい。<br>- 相談の初期段階で、正確な計算を手作業で行うのは手間がかかる。<br>- 複数の相続パターンをその場で提示し、顧客の理解を深めたい。 |
| **ニーズ** | - 顧客と一緒に画面を見ながら、その場で条件を変えてシミュレーションできるツール。<br>- 計算結果の信頼性が高く、根拠となる変数が明確であること。<br>- 複雑な家族構成にも対応できる柔軟な家系図作成機能。 |

---

### 4. 機能要件

#### 4.1. 家系図インターフェース (Family Tree UI)
| 要件ID | 機能 | 詳細 |
| :--- | :--- | :--- |
| FU-01 | **インタラクティブな家系図描画** | - ドラッグ＆ドロップで人物ノードをキャンバス上に自由に配置できる。 <br> - ユーザーは人物ノード間の関係性を定義できる（例：親子、配偶者）。関係性は線で視覚化される。 |
| FU-02 | **人物ノードの管理** | - キャンバスへの人物ノードの追加・削除機能。 <br> - 各ノードには名前、役割、ステータスを表示する。 |
| FU-03 | **状態の視覚化** | - 人物のステータス（例：「二次被相続人」「相続人」「相続放棄」）に応じて、ノードの見た目（アイコン、バッジ、色など）が変化する。 |
| FU-04 | **リアルタイム結果表示** | - 計算が完了した相続人ノードには、控除額がバッジとして表示される（例：「153万円」）。 <br> - 控除対象外の場合は「対象外」と表示される。 |

#### 4.2. データ入力機能 (Data Input)
| 要件ID | 機能 | 詳細 |
| :--- | :--- | :--- |
| DI-01 | **全体情報入力** | - 一次相続の開始日（年月日）を入力できる。 <br> - 二次相続の開始日（年月日）を入力できる。 |
| DI-02 | **人物詳細情報入力** | - 家系図上の人物ノードを選択すると、専用パネルに詳細入力欄が表示される。 <br> - 入力項目：名前、役割（二次被相続人、相続人など）、ステータス（相続放棄など）。 |
| DI-03 | **計算パラメータ入力** | - **二次被相続人用**: 前回の相続税額(A)、前回取得した純資産(B)を入力。 <br> - **相続人用**: 今回取得した純資産(D)を入力。 |
| DI-04 | **入力支援** | - 各入力項目にヘルプアイコン（`?`）を設置し、カーソルを合わせると項目の意味や入力内容に関するツールチップが表示される。 |
| DI-05 | **入力値の自動集計** | - 各相続人の「今回取得した純資産(D)」の合計値を、「今回の相続財産合計(C)」として自動計算し、表示する。 |
| DI-06 | **入力エラー検知** | - 論理的に矛盾する入力（例：二次相続日 < 一次相続日）があった場合、該当の入力フィールドをハイライトし、エラーメッセージを表示する。 |

#### 4.3. 計算ロジック (Calculation Logic)
| 要件ID | 機能 | 詳細 |
| :--- | :--- | :--- |
| CL-01 | **相次相続控除額の計算** | - 国税庁の定める以下の計算式に基づき、各相続人の控除額を正確に計算する。 <br> `控除額 = A × {C / (B - A)} × (D / C) × {(10 - E) / 10}` <br> - 計算結果は円単位で保持し、表示は適切に丸める（例：万円単位）。 |
| CL-02 | **経過年数(E)の自動計算** | - 一次相続日と二次相続日の差から、経過年数を自動で算出する（1年未満は切り捨て）。 |
| CL-03 | **適用可否の自動判定** | - 以下の条件に基づき、控除の適用可否を判定する。 <br>   - 経過年数(E)が10年未満であること。 <br>   - 前回の相続税額(A)が0円より大きいこと。 <br>   - 対象者が法律上の「相続人」であること（相続放棄をしていない）。 |
| CL-04 | **リアルタイム再計算** | - いずれかの入力値（日付、金額など）が変更された場合、関連するすべての計算結果（控除額、合計額など）を即座に再計算し、UIに反映させる。 |

#### 4.4. 支援機能 (Support Features)
| 要件ID | 機能 | 詳細 |
| :--- | :--- | :--- |
| SF-01 | **家族構成テンプレート** | - 新規作成時に、「夫婦と子2人」などの典型的な家族構成のテンプレートを選択できる。 <br> - 「空白から開始」も選択肢として用意する。 |

---

### 5. 非機能要件

| カテゴリ | 要件 |
| :--- | :--- |
| **ユーザビリティ** | - **直感的操作**: 専門知識のないユーザーがマニュアルを読まずとも、基本的な操作（人物追加、情報入力、結果確認）を完遂できること。 <br> - **視覚的フィードバック**: ユーザーのアクション（クリック、入力、ドラッグ）に対して、システムの状態変化が即座に、かつ明確に視覚化されること。 |
| **パフォーマンス** | - **応答性**: 数値入力後、計算結果が1秒以内に画面に反映されること。 <br> - **描画速度**: 10人程度の家系図でも、ノードのドラッグ＆ドロップが遅延なくスムーズに行えること。 |
| **セキュリティ** | - **データプライバシー**: 入力されたデータはすべてクライアントサイド（ブラウザ）で処理・保持され、サーバーに送信・保存しない設計とする。これにより、個人情報や資産情報の漏洩リスクを最小化する。 |
| **保守性・拡張性** | - **コンポーネントベース設計**: UIを再利用可能な独立したコンポーネント（人物カード、入力フォーム等）で構築し、将来的な機能追加や仕様変更に柔軟に対応できる構造とする。 |
| **互換性** | - 最新バージョンの主要なモダンブラウザ（Chrome, Firefox, Safari, Edge）で、すべての機能が正常に動作すること。 |

---

### 6. スコープ外（将来の展望）

以下の機能はバージョン1.0のスコープ外とし、将来のリリースで検討します。
- **データ保存・読込機能**: 作成したシミュレーション内容をファイルとして保存し、後から読み込む機能。
- **印刷・PDF出力機能**: シミュレーション結果（家系図、計算結果一覧）を印刷またはPDFとしてエクスポートする機能。
- **詳細な相続税計算機能**: 相次相続控除だけでなく、基礎控除や配偶者控除などを含めた相続税全体の概算機能。
- **多言語対応**。
