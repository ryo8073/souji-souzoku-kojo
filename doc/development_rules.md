# 相次相続控除額 計算シミュレーター
# 開発ルール (Development Rules)

**文書バージョン:** 1.0  
**作成日:** 2025年6月18日  
**作成者:** Manus AI

## 1. 開発環境

### 1.1 必要なツール・環境
- **コードエディタ:** Visual Studio Code または同等のエディタ
- **バージョン管理:** Git
- **ブラウザ:** Chrome, Firefox, Safari, Edge の最新版
- **デプロイ環境:** Vercel

### 1.2 開発言語・フレームワーク
- **HTML:** HTML5
- **CSS:** CSS3, Tailwind CSS
- **JavaScript:** ES6以上
- **外部ライブラリ:**
  - Tailwind CSS (スタイリング)
  - Lucide (アイコン)

## 2. コーディング規約

### 2.1 全般的なルール
- インデントは半角スペース2文字を使用する
- ファイル末尾には改行を1行入れる
- 文字コードはUTF-8を使用する
- 行末のスペースは削除する
- 最大行長は100文字とする

### 2.2 HTML規約
- 要素の属性値は二重引用符(`"`)で囲む
- セマンティックなHTML要素を適切に使用する
- `id`属性は必要な場合のみ使用し、命名はキャメルケース（例: `mainDescription`）を使用する
- `class`属性はTailwind CSSのクラス名を使用する
- アクセシビリティを考慮し、適切な`aria-*`属性や`role`属性を使用する

### 2.3 CSS規約
- カスタムCSSは必要最小限に留め、可能な限りTailwind CSSのユーティリティクラスを使用する
- カスタムCSSが必要な場合は、クラス名はケバブケース（例: `form-input`）を使用する
- メディアクエリは、モバイルファーストの原則に従って記述する
- 色やサイズなどの値は変数化し、再利用しやすくする

### 2.4 JavaScript規約
- 変数・関数名はキャメルケース（例: `calculateDeduction`）を使用する
- 定数は大文字のスネークケース（例: `MAX_YEARS`）を使用する
- セミコロンは省略しない
- ES6のアロー関数、テンプレートリテラル、分割代入などのモダンな構文を積極的に使用する
- コメントは必要に応じて追加し、複雑なロジックには説明を付ける
- モジュール化を意識し、関連する機能はまとめる

## 3. ファイル構成

### 3.1 基本構成
```
/
├── index.html        # メインHTMLファイル
├── style.css         # カスタムスタイル定義
├── script.js         # メインJavaScriptファイル
└── data.js           # データ定義（ヘルプテキストなど）
```

### 3.2 ファイルの役割
- **index.html:** アプリケーションの構造とUIを定義
- **style.css:** Tailwind CSSを補完するカスタムスタイルを定義
- **script.js:** 計算ロジックとUIインタラクションを実装
- **data.js:** ヘルプテキストや説明文などのコンテンツデータを管理

## 4. アーキテクチャ規約

### 4.1 全体アーキテクチャ
- クライアントサイドのみの静的ウェブアプリケーションとする
- すべての処理はブラウザ上で完結させる
- データとロジックを分離し、保守性を高める

### 4.2 モジュール構成
- **UIコンポーネント:** フォーム入力、ツールチップ表示などのUI関連機能
- **計算ロジック:** 相次相続控除額の計算処理
- **データ管理:** ヘルプテキストなどのコンテンツデータ
- **ユーティリティ:** 数値フォーマットなどの共通機能

### 4.3 依存関係管理
- 外部ライブラリはCDNから読み込む
- バージョンは明示的に指定し、予期せぬ変更を防ぐ
- ライブラリの依存関係は最小限に抑える

## 5. UI/UX規約

### 5.1 レスポンシブデザイン
- モバイルファーストの設計思想に基づく
- 以下のブレークポイントに対応する:
  - スマートフォン: 〜640px
  - タブレット: 641px〜1024px
  - デスクトップ: 1025px〜

### 5.2 アクセシビリティ
- WCAG 2.1のレベルAAに準拠する
- キーボード操作のみでも全機能を利用できるようにする
- スクリーンリーダー対応のために適切なaria属性を使用する
- 色のコントラスト比は4.5:1以上を確保する

### 5.3 フォーム設計
- 入力フィールドには明確なラベルを付ける
- フォーカス状態を視覚的に明示する
- 入力値の検証は即時に行い、フィードバックを提供する
- 数値入力には適切なフォーマット（3桁区切り）を適用する

## 6. 計算ロジック規約

### 6.1 基本計算式
```javascript
// 相次相続控除額の計算式
deduction = A * (C / B) * (D / C) * ((10 - E) / 10);
```
ここで:
- A: 前回の相続で納めた相続税額
- B: 前回に取得した財産の価額
- C: 今回の相続財産の総額
- D: あなたが今回取得した財産の価額
- E: 前回の相続からの経過年数

### 6.2 計算ルール
- 計算結果は小数点以下を切り捨てて整数値とする
- 計算結果が負の値になる場合は0とする
- 以下の条件を満たさない場合、控除額は0とする:
  - B > 0 (前回に取得した財産の価額が0より大きい)
  - C > 0 (今回の相続財産の総額が0より大きい)
  - E < 10 (経過年数が10年未満)

### 6.3 入力値の処理
- 数値以外の文字（カンマなど）は自動的に除去する
- 空欄の場合は0として扱う
- 負の値は許容しない

## 7. テスト規約

### 7.1 テスト対象
- **計算ロジック:** 様々な入力値パターンでの計算結果の正確性
- **UI動作:** フォーム入力、ツールチップ表示などのインタラクション
- **レスポンシブ対応:** 異なる画面サイズでの表示
- **ブラウザ互換性:** 主要ブラウザでの動作

### 7.2 テストケース
- **正常系:** 通常の入力値での計算
- **境界値:** 0や極端に大きな値など
- **異常系:** 不正な入力値（文字列など）
- **特殊ケース:** 控除額が0になるケース

### 7.3 テスト環境
- 複数のブラウザ（Chrome, Firefox, Safari, Edge）
- 複数のデバイス（デスクトップ、タブレット、スマートフォン）
- 異なる画面解像度

## 8. デプロイ規約

### 8.1 デプロイ環境
- **ホスティングサービス:** Vercel
- **ドメイン:** Vercelが提供するデフォルトドメインを使用

### 8.2 デプロイ手順
1. GitHubリポジトリにコードをプッシュする
2. Vercelとリポジトリを連携する
3. ビルド設定を確認する（静的サイトとして設定）
4. デプロイを実行する
5. デプロイ後の動作確認を行う

### 8.3 デプロイ前チェックリスト
- すべてのコードがリポジトリにコミットされている
- ローカル環境でのテストが完了している
- コンソールエラーがないことを確認している
- パフォーマンス最適化（画像圧縮、コード最小化など）が行われている

## 9. パフォーマンス最適化

### 9.1 ロード時間の最適化
- 外部リソース（CSS, JavaScript）の読み込みを最適化する
- 画像は適切に圧縮する
- キャッシュ戦略を適用する

### 9.2 実行パフォーマンス
- 計算処理は効率的に実装する
- DOM操作は最小限に抑える
- イベントリスナーは適切に管理する

### 9.3 メモリ使用量
- 不要なオブジェクトは適切に解放する
- メモリリークを防ぐために、イベントリスナーは必要に応じて削除する

## 10. セキュリティ規約

### 10.1 クライアントサイドセキュリティ
- ユーザー入力値は適切にサニタイズする
- 機密情報は扱わない
- 外部リソースは信頼できるソースからのみ読み込む

### 10.2 データ保護
- ユーザーデータはローカルのみで処理し、外部に送信しない
- セッション終了後にデータは保持しない

## 11. ドキュメント規約

### 11.1 コードドキュメント
- 関数には適切なJSDocコメントを付ける
- 複雑なロジックには説明コメントを追加する
- 重要な変数や定数には説明を付ける

### 11.2 ユーザードキュメント
- アプリケーションの使用方法を明確に説明する
- 入力項目の説明は具体的かつ分かりやすく記述する
- 計算結果の解釈方法を説明する

## 12. 保守・拡張規約

### 12.1 コード保守性
- 関連する機能はモジュール化する
- ハードコーディングを避け、定数や設定を分離する
- 命名規則を一貫して適用する

### 12.2 拡張性
- 将来的な機能追加を考慮した設計とする
- データとロジックを分離し、変更の影響範囲を限定する
- 共通機能はユーティリティとして実装し、再利用可能にする

### 12.3 バージョン管理
- セマンティックバージョニングを採用する
- 変更履歴を明確に記録する
- 重要な変更点はコミットメッセージに詳細を記載する
