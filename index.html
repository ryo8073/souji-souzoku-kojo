<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="相次相続控除額を簡単に計算できるシミュレーター。専門知識がなくても直感的に操作できます。国税庁準拠の正確な計算で安心して相続に向き合えます。">
    <meta name="keywords" content="相次相続控除,相続税,計算,シミュレーター,税理士,相続対策">
    <meta name="author" content="株式会社Profomer">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="相次相続控除額 計算シミュレーター">
    <meta property="og:description" content="専門知識がなくても相次相続控除を簡単に計算できるツール">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com">
    
    <title>相次相続控除額 計算シミュレーター</title>
    
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- 2025年最新のデザインシステム -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- フォント最適化 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- ファビコン -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌳</text></svg>">
    
    <!-- パフォーマンス最適化 -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//unpkg.com">
    <link rel="dns-prefetch" href="//cdn.tailwindcss.com">
</head>
<body class="bg-slate-50 font-sans text-slate-800 antialiased dark:bg-slate-900 dark:text-slate-200">

  <div id="app-container" class="relative min-h-screen">
    <!-- Background Gradient -->
    <div class="absolute inset-x-0 top-0 -z-10 h-[800px] bg-gradient-to-b from-primary-100/30 to-transparent dark:from-primary-900/10"></div>
    <div class="absolute right-0 top-1/2 -z-10 h-64 w-64 -translate-y-1/2 rounded-full bg-secondary-100/50 blur-3xl dark:bg-secondary-900/20"></div>

    <!-- Header -->
    <header class="sticky top-0 z-30 bg-white/70 backdrop-blur-lg dark:bg-slate-900/70">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex h-16 items-center justify-between border-b border-slate-200 dark:border-slate-800">
          <div class="flex items-center gap-3">
            <svg class="h-8 w-8 text-primary-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 22a7 7 0 0 0 7-7h-2a5 5 0 0 1-5 5v2z"></path>
              <path d="M12 2a7 7 0 0 0-7 7h2a5 5 0 0 1 5-5V2z"></path>
              <path d="M22 12a7 7 0 0 0-7-7v2a5 5 0 0 1 5 5h2z"></path>
              <path d="M2 12a7 7 0 0 0 7 7v-2a5 5 0 0 1-5-5H2z"></path>
              <path d="m15 12-3-3-3 3"></path>
              <path d="M12 15.5V9"></path>
            </svg>
            <h1 class="text-xl font-bold tracking-tight text-slate-900 dark:text-white">相次相続控除シミュレーター</h1>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-xs font-medium text-slate-500">監修: 株式会社Profomer</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="mx-auto w-full max-w-7xl px-4 py-10 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 gap-16 lg:grid-cols-5">

        <!-- Left Column: Story & Visualization -->
        <div class="lg:col-span-2">
          <div class="sticky top-24 space-y-8">
            <!-- STORYセクションを中央寄せ・カード形式に -->
            <div class="card mx-auto my-6 p-6 max-w-2xl text-center bg-white shadow">
              <div class="card-header">
                <h2 class="text-lg font-bold mb-2">STORY</h2>
                <h3 class="text-2xl font-bold mb-2">2つの相続、1つの物語</h3>
                <p class="text-slate-600">10年以内に2度の相続を経験された方向けの、相次相続控除額を計算するシミュレーターです。この制度は、短い期間に繰り返し課される相続税の負担を和らげるために設けられています。</p>
              </div>
            </div>
            <!-- 相次相続控除の条件説明を追加 -->
            <div class="explanation-block my-6 text-center">
              <strong>【相次相続控除の条件】</strong><br>
              被相続人が10年以内に相続税を納めていた場合、法定相続人は一定の条件のもとで相次相続控除を受けられます。<br>
              <span class="text-sm text-slate-600">※控除を受けられるのは、被相続人の「法定相続人」として財産を取得した方に限られます。</span>
            </div>

            <!-- 家系図をさらに大きく中央寄せ -->
            <div class="card mx-auto my-6 p-4 max-w-3xl bg-slate-50 shadow">
              <div class="card-header text-center">
                <h3 class="card-title text-xl font-bold mb-2">登場人物の関係図</h3>
              </div>
              <div class="card-body flex justify-center">
                <div id="family-tree-placeholder" class="aspect-[4/3] w-full max-w-2xl overflow-hidden rounded-lg bg-slate-100">
                  <img src="/family-tree.png" alt="相次相続の事例を示す家系図" class="h-full w-full object-contain">
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Right Column: Calculator -->
        <div id="app" class="lg:col-span-3 flex flex-col items-center">
          <div class="space-y-6 w-full max-w-xl mx-auto">
            <!-- 相続人選択カードを削除 -->

            <div id="input-card" class="card mx-auto my-6 p-4 max-w-xl bg-white shadow">
              <div class="card-header text-center">
                <h3 class="card-title text-lg font-bold mb-2">計算条件の入力</h3>
              </div>
              <div class="card-body">
                <!-- 入力切替トグル -->
                <div class="flex justify-center mb-4 gap-2">
                  <button id="calc-mode-single" type="button" class="calc-mode-btn px-4 py-2 rounded font-bold border border-blue-500 text-blue-700 bg-blue-100" aria-pressed="true">1人ずつ計算</button>
                  <button id="calc-mode-multi" type="button" class="calc-mode-btn px-4 py-2 rounded font-bold border border-gray-300 text-gray-700 bg-white" aria-pressed="false">複数人計算</button>
                </div>
                <!-- 1人ずつ計算時: 相続人選択ドロップダウン -->
                <div id="single-heir-select-row" class="mb-4">
                  <label for="single-heir-select" class="block text-sm text-slate-700 mb-1">
                    <span class="font-bold">相続人の選択</span><span class="font-normal">(＊上記事例の内容が反映されます)</span>
                  </label>
                  <select id="single-heir-select" class="form-input w-full max-w-xs mx-auto">
                    <!-- JSで動的にoptionを生成 -->
                  </select>
                </div>
                <div class="text-xs text-slate-500 mb-2">※あなたご自身の状況に合わせて入力を変えることで、上記の事例以外の件も計算できます。</div>
                <div class="space-y-6 p-1">
                  <!-- Basic Information -->
                  <div class="space-y-5">
                    <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wide">基本情報</h4>
                    <div id="input-A"></div>
                    <div id="input-B"></div>
                    <div id="input-C"></div>
                    <div id="input-D"></div>
                  </div>
                  
                  <!-- Period Calculation -->
                  <div class="space-y-3 pt-2 border-t border-slate-200 dark:border-slate-700">
                    <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wide">期間の計算</h4>
                    <div id="input-E-method"></div>
                    <div id="input-E-years" class="hidden"></div>
                    <div class="flex flex-col sm:flex-row gap-3">
                      <div id="input-E1" class="hidden flex-1"></div>
                      <div id="input-E2" class="hidden flex-1"></div>
                    </div>
                    <div id="input-E" class="hidden"></div>
                  </div>
                </div>
              </div>
              <!-- D欄説明 -->
              <div id="desc-D" class="mb-2 text-sm font-bold text-slate-700 hidden">
                <span class="font-bold">(D)あなたの取得財産価額：</span> 
                <span class="font-normal text-slate-600">今回の相続であなたが実際に取得した財産の金額を入力してください。控除額の計算対象となります。</span>
              </div>
              <!-- 横スクロールラッパー -->
              <div class="overflow-x-auto">
                <!-- 複数人計算時: D欄をEの下に移動し、相続人表＋説明文を表示 -->
                <div id="multi-heirs-table" class="hidden mb-4">
                  <div class="text-xs text-slate-500 mb-2">事例以外にあなた自身の状況に合わせて、入力を変えることで、あなたの2次相続の控除額が計算できます。</div>
                  <div class="multi-heirs-table-container">
                    <table id="multi-heirs-table" class="w-full text-sm">
                      <thead>
                        <tr>
                          <th>続柄</th>
                          <th>区分</th>
                          <th>取得財産額</th>
                          <th>控除額</th>
                          <th>理由</th>
                        </tr>
                      </thead>
                      <tbody id="multi-heirs-tbody">
                        <!-- JSで行を生成 -->
                      </tbody>
                    </table>
                  </div>
                  <div class="flex justify-end mt-2 gap-2">
                    <button id="add-heir-btn" class="btn btn-sm btn-outline">＋相続人を追加</button>
                  </div>
                  <!-- 注記はJSでのみ表示 -->
                </div>
              </div>
              <!-- 新しい注記文言をここに追加 -->
              <div class="table-note mt-2 text-xs text-slate-500">
                ※控除額は「法定相続人」として財産を取得した方のみ計算されます。<br>
                計算結果の詳細は表の一番上の法定相続人について表示されます。
              </div>
              <div class="card-footer">
                <button id="calculate-button" class="btn btn-primary w-full">
                  <span class="button-text">控除額を計算する</span>
                  <i data-lucide="arrow-right" class="button-icon"></i>
                  <div class="button-spinner"></div>
                </button>
              </div>
            </div>
            
            <!-- Result Section -->
            <div class="sticky bottom-6">
              <div id="result-container" class="card bg-gradient-to-br from-slate-800 to-slate-900 text-white opacity-0 transition-all duration-500 dark:from-primary-600 dark:to-secondary-700">
                <div class="card-body">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                      <div class="grid h-12 w-12 place-items-center rounded-full bg-white/10">
                        <i data-lucide="shield-check" class="h-6 w-6 text-white"></i>
                      </div>
                      <div>
                        <h3 class="font-bold text-white">あなたの相次相続控除額</h3>
                        <p class="text-sm text-slate-300">シミュレーション結果</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p id="result-amount" class="text-4xl font-bold">0<span class="ml-1.5 text-2xl opacity-80">円</span></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Calculation Process Section -->
            <div id="calculation-process-container" class="card hidden">
              <!-- Calculation process will be rendered here by ui.js -->
            </div>

          </div>
        </div>

      </div>
    </main>
  </div>
  
  <!-- JavaScript（依存順に並べる） -->
  <script src="config.js"></script>
  <script src="templates.js"></script>
  <script src="utils.js"></script>
  <script src="validation.js"></script>
  <script src="calculator.js"></script>
  <script src="accessibility.js"></script>
  <script src="ui.js"></script>
  <script src="state.js"></script>
  <script src="main.js"></script>
  <script>
    lucide.createIcons();
  </script>
</body>
